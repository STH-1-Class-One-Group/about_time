<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Step 4 â€” queueMicrotask</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0d0d1a; --surface: #13132b; --border: #2a2a4a;
            --text: #e8e8ff; --muted: #6666aa;
            --pika: #f1c40f; --squirt: #3498db; --bulba: #2ecc71; --jiggly: #e91e8c;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'IBM Plex Mono', monospace; background: var(--bg); color: var(--text); padding: 40px 20px; }

        h1 { font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--jiggly); text-align: center; margin-bottom: 8px; line-height: 1.8; }
        .subtitle { text-align: center; color: var(--muted); font-size: 0.7rem; margin-bottom: 32px; }

        .race-track { display: flex; gap: 14px; max-width: 1100px; margin: 0 auto 24px; flex-wrap: wrap; }
        .panel { flex: 1 1 220px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 18px; }
        .panel.taskqueue  { background: rgba(52,152,219,0.06);  border-color: rgba(52,152,219,0.25); }
        .panel.microtask  { background: rgba(46,204,113,0.06);  border-color: rgba(46,204,113,0.25); }
        .panel.microtask2 { background: rgba(233,30,140,0.06);  border-color: rgba(233,30,140,0.25); }
        .panel h2 { font-family: 'Press Start 2P', monospace; font-size: 0.48rem; text-align: center; margin-bottom: 12px; line-height: 1.9; padding-bottom: 10px; border-bottom: 1px solid var(--border); }

        .card { border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; margin-bottom: 8px; background: rgba(255,255,255,0.03); animation: popIn 0.2s ease; }
        .card p { font-size: 0.68rem; margin: 2px 0; }
        @keyframes popIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

        .timer { font-size: 0.62rem; text-align: center; margin-bottom: 10px; font-weight: 600; }

        .btn-row { display: flex; justify-content: center; margin-bottom: 32px; }
        button { font-family: 'Press Start 2P', monospace; font-size: 0.6rem; padding: 14px 28px; background: var(--jiggly); color: #fff; border: none; border-radius: 4px; cursor: pointer; box-shadow: 0 4px 0 #8a0a50; }
        button:active { transform: translateY(2px); }

        .console-tip { text-align: center; font-size: 0.65rem; color: var(--muted); margin-bottom: 24px; }
        .console-tip code { color: var(--jiggly); }

        .explain { background: rgba(233,30,140,0.06); border: 1px solid rgba(233,30,140,0.2); border-radius: 8px; padding: 16px; max-width: 1100px; margin: 0 auto; font-size: 0.68rem; line-height: 1.9; color: var(--muted); }
        .explain strong { color: var(--text); }
    </style>
</head>
<body>

    <h1>Step 4</h1>
    <h1 style="margin-top:4px; color:var(--jiggly);">queueMicrotask()</h1>
    <p class="subtitle">Promise ì—†ì´ ì§ì ‘ Microtask Queueì— ë“±ë¡</p>
    <p class="console-tip">ğŸ’¡ <code>F12 â†’ Console</code> í•µì‹¬: í‘¸ë¦°ì´ ê¼¬ë¶€ê¸°ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬ë©ë‹ˆë‹¤</p>

    <div class="btn-row">
        <button id="start-btn">ğŸ START</button>
    </div>

    <div class="race-track">
        <div class="panel">
            <h2 style="color:var(--pika);">â‘  Pikachu ğŸŸ¡<br>CallStack (ë™ê¸°)</h2>
            <div id="sync-timer" class="timer" style="color:var(--pika);">Ready...</div>
            <div id="sync-container"></div>
        </div>

        <div class="panel taskqueue">
            <h2 style="color:var(--squirt);">â‘¡ Squirtle ğŸ”µ<br>Task Queue<br>(setTimeout)</h2>
            <div id="squirtle-timer" class="timer" style="color:var(--squirt);">Ready...</div>
            <div id="squirtle-container"></div>
        </div>

        <div class="panel microtask">
            <h2 style="color:var(--bulba);">â‘¢ Bulbasaur ğŸŒ¿<br>Microtask<br>(Promise .then)</h2>
            <div id="bulba-timer" class="timer" style="color:var(--bulba);">Ready...</div>
            <div id="bulba-container"></div>
        </div>

        <div class="panel microtask2">
            <h2 style="color:var(--jiggly);">â‘£ Jigglypuff ğŸ’—<br>Microtask<br>(queueMicrotask)</h2>
            <div id="jiggly-timer" class="timer" style="color:var(--jiggly);">Ready...</div>
            <div id="jiggly-container"></div>
        </div>
    </div>

    <div class="explain">
        <strong>queueMicrotask() ë€?</strong><br><br>
        Promiseë¥¼ ë§Œë“¤ì§€ ì•Šê³  <strong>ì§ì ‘ Microtask Queueì— í•¨ìˆ˜ë¥¼ ë°€ì–´ë„£ëŠ”</strong> Web APIì…ë‹ˆë‹¤.<br><br>
        Promise .thenê³¼ ë™ì¼í•œ íì— ë“¤ì–´ê°€ë¯€ë¡œ,<br>
        â‘¢ ì´ìƒí•´ì”¨ì™€ â‘£ í‘¸ë¦°ì€ ë‘˜ ë‹¤ Task Queue(ê¼¬ë¶€ê¸°)ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬ë©ë‹ˆë‹¤.<br><br>
        ì½˜ì†”ì—ì„œ â‘¢ BULBAì™€ â‘£ JIGGLY ì‹¤í–‰ ë¡œê·¸ê°€<br>
        â‘¡ SQUIRT ì‹¤í–‰ ë¡œê·¸ë³´ë‹¤ ë¨¼ì € ì°íˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
    </div>

    <script>
        const raceStart = { time: 0 };

        function log(section, message) {
            const elapsed = ((performance.now() - raceStart.time) / 1000).toFixed(3);
            console.log(`[${elapsed}s] %c${section}%c ${message}`,
                'font-weight:bold; color:#aaffaa;', 'font-weight:normal;');
        }

        function renderCard(containerId, name, label, color) {
            const elapsed = ((performance.now() - raceStart.time) / 1000).toFixed(3);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <p><strong style="color:${color};">${name}</strong></p>
                <p style="color:${color}; font-size:0.58rem;">${label}</p>
                <p style="color:var(--muted); font-size:0.52rem;">+${elapsed}s</p>
            `;
            document.getElementById(containerId).appendChild(card);
        }

        function runPikaSection() {
            document.getElementById('sync-container').innerHTML = '';
            document.getElementById('sync-timer').innerText = 'Running...';
            log('â‘  PIKA  ', 'â–¶ ì‹œì‘ â€” CallStack ë¸”ë¡œí‚¹');
            for (const name of ['í”¼ì¸„', 'í”¼ì¹´ì¸„', 'ë¼ì´ì¸„']) {
                log('â‘  PIKA  ', `  ì‹¤í–‰ â†’ ${name}`);
                renderCard('sync-container', name, 'CallStack (ë™ê¸°)', 'var(--pika)');
            }
            log('â‘  PIKA  ', 'â–  ì™„ë£Œ');
            document.getElementById('sync-timer').innerText = 'âœ… ì™„ë£Œ';
        }

        function runSquirtleSection() {
            document.getElementById('squirtle-container').innerHTML = '';
            document.getElementById('squirtle-timer').innerText = 'Waiting...';
            log('â‘¡ SQUIRT', 'â–¶ setTimeout 0ms ë“±ë¡');
            ['ê¼¬ë¶€ê¸°', 'ì–´ë‹ˆë¶€ê¸°', 'ê±°ë¶ì™•'].forEach((name, i) => {
                setTimeout(() => {
                    log('â‘¡ SQUIRT', `  âœ… Task Queue ì‹¤í–‰ â†’ ${name}`);
                    renderCard('squirtle-container', name, 'Task Queue (setTimeout)', 'var(--squirt)');
                    if (i === 2) document.getElementById('squirtle-timer').innerText = 'âœ… ì™„ë£Œ';
                }, 0);
                log('â‘¡ SQUIRT', `  ë“±ë¡ (${name})`);
            });
            log('â‘¡ SQUIRT', 'â–  ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜');
        }

        function runBulbaSection() {
            document.getElementById('bulba-container').innerHTML = '';
            document.getElementById('bulba-timer').innerText = 'Waiting...';
            log('â‘¢ BULBA ', 'â–¶ Promise.resolve().then ì²´ì¸ ë“±ë¡');
            ['ì´ìƒí•´ì”¨', 'ì´ìƒí•´í’€', 'ì´ìƒí•´ê½ƒ'].reduce((chain, name, i) => {
                return chain.then(() => {
                    log('â‘¢ BULBA ', `  âœ… Microtask .then() â†’ ${name}`);
                    renderCard('bulba-container', name, 'Microtask (Promise .then)', 'var(--bulba)');
                    if (i === 2) document.getElementById('bulba-timer').innerText = 'âœ… ì™„ë£Œ';
                });
            }, Promise.resolve());
            log('â‘¢ BULBA ', 'â–  ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜');
        }

        // â‘£ í‘¸ë¦° â€” queueMicrotask ì§ì ‘ ë“±ë¡
        function runJigglypuffSection() {
            document.getElementById('jiggly-container').innerHTML = '';
            document.getElementById('jiggly-timer').innerText = 'Waiting...';
            log('â‘£ JIGGLY', 'â–¶ queueMicrotask ì§ì ‘ ë“±ë¡');

            ['í‘¸ë¦°', 'í‘¸í¬ë¦°'].forEach((name, i) => {
                // Promiseë¥¼ ì „í˜€ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì§ì ‘ Microtask Queueì— ë“±ë¡
                queueMicrotask(() => {
                    log('â‘£ JIGGLY', `  âœ… Microtask queueMicrotask â†’ ${name}`);
                    renderCard('jiggly-container', name, 'Microtask (queueMicrotask)', 'var(--jiggly)');
                    if (i === 1) document.getElementById('jiggly-timer').innerText = 'âœ… ì™„ë£Œ';
                });
                log('â‘£ JIGGLY', `  ë“±ë¡ (${name}) â†’ Promise ì—†ì´ ì§ì ‘ Microtask Queue`);
            });

            log('â‘£ JIGGLY', 'â–  ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜');
        }

        document.getElementById('start-btn').addEventListener('click', () => {
            raceStart.time = performance.now();
            console.clear();
            console.log('%c=== Step 4: queueMicrotask ===', 'font-size:1rem; font-weight:bold; color:#e91e8c;');
            console.log('%câ‘¢â‘£ ë§ˆì´í¬ë¡œíƒœìŠ¤í¬ê°€ ëª¨ë‘ ëë‚œ í›„ì—ì•¼ â‘¡ ê¼¬ë¶€ê¸°ê°€ ì²˜ë¦¬ë©ë‹ˆë‹¤.', 'color:#888;');
            console.log('');

            runPikaSection();
            runSquirtleSection();
            runBulbaSection();
            runJigglypuffSection();
        });
    </script>
</body>
</html>