<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Step 5 â€” MutationObserver</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0d0d1a; --surface: #13132b; --border: #2a2a4a;
            --text: #e8e8ff; --muted: #6666aa;
            --pika: #f1c40f; --squirt: #3498db; --bulba: #2ecc71;
            --jiggly: #e91e8c; --caterpie: #ff6b35;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'IBM Plex Mono', monospace; background: var(--bg); color: var(--text); padding: 40px 20px; }

        h1 { font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--caterpie); text-align: center; margin-bottom: 8px; line-height: 1.8; }
        .subtitle { text-align: center; color: var(--muted); font-size: 0.7rem; margin-bottom: 32px; }

        .race-track { display: flex; gap: 12px; max-width: 1200px; margin: 0 auto 24px; flex-wrap: wrap; }
        .panel { flex: 1 1 180px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px; }
        .panel.taskqueue  { background: rgba(52,152,219,0.06);  border-color: rgba(52,152,219,0.25); }
        .panel.microtask  { background: rgba(46,204,113,0.06);  border-color: rgba(46,204,113,0.25); }
        .panel.microtask2 { background: rgba(233,30,140,0.06);  border-color: rgba(233,30,140,0.25); }
        .panel.microtask3 { background: rgba(255,107,53,0.06);  border-color: rgba(255,107,53,0.25); }
        .panel h2 { font-family: 'Press Start 2P', monospace; font-size: 0.44rem; text-align: center; margin-bottom: 12px; line-height: 2; padding-bottom: 8px; border-bottom: 1px solid var(--border); }

        .card { border: 1px solid var(--border); border-radius: 8px; padding: 8px 10px; margin-bottom: 8px; background: rgba(255,255,255,0.03); animation: popIn 0.2s ease; }
        .card p { font-size: 0.65rem; margin: 2px 0; }
        @keyframes popIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

        .timer { font-size: 0.58rem; text-align: center; margin-bottom: 8px; font-weight: 600; min-height: 1.4em; }

        .btn-row { display: flex; justify-content: center; margin-bottom: 32px; }
        button { font-family: 'Press Start 2P', monospace; font-size: 0.6rem; padding: 14px 28px; background: var(--caterpie); color: #fff; border: none; border-radius: 4px; cursor: pointer; box-shadow: 0 4px 0 #a03800; }
        button:active { transform: translateY(2px); }

        .console-tip { text-align: center; font-size: 0.65rem; color: var(--muted); margin-bottom: 24px; }
        .console-tip code { color: var(--caterpie); }

        .explain { background: rgba(255,107,53,0.06); border: 1px solid rgba(255,107,53,0.2); border-radius: 8px; padding: 16px; max-width: 1200px; margin: 0 auto; font-size: 0.68rem; line-height: 1.9; color: var(--muted); }
        .explain strong { color: var(--text); }

        .summary-grid { display: flex; gap: 10px; max-width: 1200px; margin: 24px auto 0; flex-wrap: wrap; }
        .summary-item { flex: 1 1 180px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px; font-size: 0.6rem; line-height: 1.8; }
        .summary-item .label { font-family: 'Press Start 2P', monospace; font-size: 0.42rem; margin-bottom: 6px; }
    </style>
</head>
<body>

    <h1>Step 5 â€” FINAL</h1>
    <h1 style="margin-top:4px; color:var(--caterpie);">MutationObserver</h1>
    <p class="subtitle">5ê°€ì§€ ì „ë¶€ â€” ì´ë²¤íŠ¸ ë£¨í”„ ì™„ì„±</p>
    <p class="console-tip">ğŸ’¡ <code>F12 â†’ Console</code> ì „ì²´ ì‹¤í–‰ ìˆœì„œë¥¼ íƒ€ì„ìŠ¤íƒ¬í”„ë¡œ í™•ì¸í•˜ì„¸ìš”</p>

    <div class="btn-row">
        <button id="start-btn">ğŸ FINAL RACE START</button>
    </div>

    <div class="race-track">
        <div class="panel">
            <h2 style="color:var(--pika);">â‘  Pikachu ğŸŸ¡<br>CallStack<br>(ë™ê¸°)</h2>
            <div id="sync-timer" class="timer" style="color:var(--pika);">Ready...</div>
            <div id="sync-container"></div>
        </div>

        <div class="panel taskqueue">
            <h2 style="color:var(--squirt);">â‘¡ Squirtle ğŸ”µ<br>Task Queue<br>(setTimeout)</h2>
            <div id="squirtle-timer" class="timer" style="color:var(--squirt);">Ready...</div>
            <div id="squirtle-container"></div>
        </div>

        <div class="panel microtask">
            <h2 style="color:var(--bulba);">â‘¢ Bulbasaur ğŸŒ¿<br>Microtask<br>(Promise .then)</h2>
            <div id="bulba-timer" class="timer" style="color:var(--bulba);">Ready...</div>
            <div id="bulba-container"></div>
        </div>

        <div class="panel microtask2">
            <h2 style="color:var(--jiggly);">â‘£ Jigglypuff ğŸ’—<br>Microtask<br>(queueMicrotask)</h2>
            <div id="jiggly-timer" class="timer" style="color:var(--jiggly);">Ready...</div>
            <div id="jiggly-container"></div>
        </div>

        <div class="panel microtask3">
            <h2 style="color:var(--caterpie);">â‘¤ Caterpie ğŸ›<br>Microtask<br>(MutationObserver)</h2>
            <div id="caterpie-timer" class="timer" style="color:var(--caterpie);">Ready...</div>
            <div id="caterpie-container"></div>
        </div>
    </div>

    <div class="explain">
        <strong>MutationObserver ë€?</strong><br><br>
        DOMì˜ ë³€í™”(ìì‹ ì¶”ê°€, ì†ì„± ë³€ê²½ ë“±)ë¥¼ ê°ì§€í•˜ë©´<br>
        ì½œë°±ì„ <strong>Microtask Queueì— ë“±ë¡</strong>í•©ë‹ˆë‹¤.<br><br>
        ì—¬ê¸°ì„œëŠ” ì½œë°± ì•ˆì—ì„œ ë‹¤ì‹œ DOMì„ ê±´ë“œë ¤<br>
        ìºí„°í”¼ â†’ ë‹¨ë°ê¸° â†’ ë²„í„°í”Œì„ <strong>ì—°ì‡„ì ìœ¼ë¡œ</strong> íŠ¸ë¦¬ê±°í•©ë‹ˆë‹¤.<br><br>
        â†’ â‘¢â‘£â‘¤ ëª¨ë‘ Microtaskì´ë¯€ë¡œ â‘¡ ê¼¬ë¶€ê¸°ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬ë©ë‹ˆë‹¤.
    </div>

    <div class="summary-grid">
        <div class="summary-item">
            <div class="label" style="color:var(--pika);">â‘  CallStack</div>
            ë™ê¸° ë¸”ë¡œí‚¹<br>ë£¨í”„ê°€ ëë‚  ë•Œê¹Œì§€<br>ë‹¤ë¥¸ ëª¨ë“  ê²ƒ ëŒ€ê¸°
        </div>
        <div class="summary-item">
            <div class="label" style="color:var(--squirt);">â‘¡ Task Queue</div>
            setTimeout<br>Microtask ì „ë¶€ ì†Œì§„ í›„<br>í•˜ë‚˜ì”© ì²˜ë¦¬
        </div>
        <div class="summary-item">
            <div class="label" style="color:var(--bulba);">â‘¢ Microtask</div>
            Promise .then<br>ì½œìŠ¤íƒ ë¹Œ ë•Œë§ˆë‹¤<br>í ì „ì²´ ì†Œì§„
        </div>
        <div class="summary-item">
            <div class="label" style="color:var(--jiggly);">â‘£ Microtask</div>
            queueMicrotask<br>Promise ì—†ì´<br>ì§ì ‘ ë“±ë¡
        </div>
        <div class="summary-item">
            <div class="label" style="color:var(--caterpie);">â‘¤ Microtask</div>
            MutationObserver<br>DOM ë³€í™” ê°ì§€<br>ì—°ì‡„ íŠ¸ë¦¬ê±° ê°€ëŠ¥
        </div>
    </div>

    <script>
        const raceStart = { time: 0 };

        function log(section, message) {
            const elapsed = ((performance.now() - raceStart.time) / 1000).toFixed(3);
            console.log(`[${elapsed}s] %c${section}%c ${message}`,
                'font-weight:bold; color:#aaffaa;', 'font-weight:normal;');
        }

        function renderCard(containerId, name, label, color) {
            const elapsed = ((performance.now() - raceStart.time) / 1000).toFixed(3);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <p><strong style="color:${color};">${name}</strong></p>
                <p style="color:${color}; font-size:0.55rem;">${label}</p>
                <p style="color:var(--muted); font-size:0.5rem;">+${elapsed}s</p>
            `;
            document.getElementById(containerId).appendChild(card);
        }

        function runPikaSection() {
            document.getElementById('sync-container').innerHTML = '';
            document.getElementById('sync-timer').innerText = 'Running...';
            log('â‘  PIKA  ', 'â–¶ CallStack ë¸”ë¡œí‚¹ ì‹œì‘');
            for (const name of ['í”¼ì¸„', 'í”¼ì¹´ì¸„', 'ë¼ì´ì¸„']) {
                log('â‘  PIKA  ', `  ì‹¤í–‰ â†’ ${name}`);
                renderCard('sync-container', name, 'CallStack (ë™ê¸°)', 'var(--pika)');
            }
            log('â‘  PIKA  ', 'â–  ì™„ë£Œ');
            document.getElementById('sync-timer').innerText = 'âœ… ì™„ë£Œ';
        }

        function runSquirtleSection() {
            document.getElementById('squirtle-container').innerHTML = '';
            document.getElementById('squirtle-timer').innerText = 'Waiting...';
            log('â‘¡ SQUIRT', 'â–¶ setTimeout 0ms ë“±ë¡');
            ['ê¼¬ë¶€ê¸°', 'ì–´ë‹ˆë¶€ê¸°', 'ê±°ë¶ì™•'].forEach((name, i) => {
                setTimeout(() => {
                    log('â‘¡ SQUIRT', `  âœ… Task Queue ì‹¤í–‰ â†’ ${name}`);
                    renderCard('squirtle-container', name, 'Task Queue (setTimeout)', 'var(--squirt)');
                    if (i === 2) document.getElementById('squirtle-timer').innerText = 'âœ… ì™„ë£Œ';
                }, 0);
                log('â‘¡ SQUIRT', `  ë“±ë¡ â†’ ${name}`);
            });
            log('â‘¡ SQUIRT', 'â–  ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜');
        }

        function runBulbaSection() {
            document.getElementById('bulba-container').innerHTML = '';
            document.getElementById('bulba-timer').innerText = 'Waiting...';
            log('â‘¢ BULBA ', 'â–¶ Promise.resolve().then ì²´ì¸ ë“±ë¡');
            ['ì´ìƒí•´ì”¨', 'ì´ìƒí•´í’€', 'ì´ìƒí•´ê½ƒ'].reduce((chain, name, i) => {
                return chain.then(() => {
                    log('â‘¢ BULBA ', `  âœ… Microtask .then() â†’ ${name}`);
                    renderCard('bulba-container', name, 'Microtask (Promise .then)', 'var(--bulba)');
                    if (i === 2) document.getElementById('bulba-timer').innerText = 'âœ… ì™„ë£Œ';
                });
            }, Promise.resolve());
            log('â‘¢ BULBA ', 'â–  ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜');
        }

        function runJigglypuffSection() {
            document.getElementById('jiggly-container').innerHTML = '';
            document.getElementById('jiggly-timer').innerText = 'Waiting...';
            log('â‘£ JIGGLY', 'â–¶ queueMicrotask ì§ì ‘ ë“±ë¡');
            ['í‘¸ë¦°', 'í‘¸í¬ë¦°'].forEach((name, i) => {
                queueMicrotask(() => {
                    log('â‘£ JIGGLY', `  âœ… queueMicrotask ì‹¤í–‰ â†’ ${name}`);
                    renderCard('jiggly-container', name, 'Microtask (queueMicrotask)', 'var(--jiggly)');
                    if (i === 1) document.getElementById('jiggly-timer').innerText = 'âœ… ì™„ë£Œ';
                });
                log('â‘£ JIGGLY', `  ë“±ë¡ â†’ ${name}`);
            });
            log('â‘£ JIGGLY', 'â–  ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜');
        }

        function runCaterpieSection() {
            const container = document.getElementById('caterpie-container');
            container.innerHTML = '';
            document.getElementById('caterpie-timer').innerText = 'Waiting...';
            log('â‘¤ CATER ', 'â–¶ MutationObserver ë“±ë¡');

            const caterpieFamily = ['ìºí„°í”¼', 'ë‹¨ë°ê¸°', 'ë²„í„°í”Œ'];
            let index = 0;

            const observer = new MutationObserver(() => {
                // DOM ë³€í™” ê°ì§€ â†’ ì´ ì½œë°±ì´ Microtask Queueì— ë“±ë¡ë¨
                if (index >= caterpieFamily.length) {
                    observer.disconnect();
                    document.getElementById('caterpie-timer').innerText = 'âœ… ì™„ë£Œ';
                    return;
                }
                const name = caterpieFamily[index++];
                log('â‘¤ CATER ', `  âœ… MutationObserver ì½œë°± ì‹¤í–‰ â†’ ${name}`);
                renderCard('caterpie-container', name, 'Microtask (MutationObserver)', 'var(--caterpie)');

                // ë‹¤ìŒ í¬ì¼“ëª¬ì„ ìœ„í•´ ë˜ DOM ë³€í™” â†’ ì—°ì‡„ íŠ¸ë¦¬ê±°
                if (index < caterpieFamily.length) {
                    const next = document.createElement('div');
                    next.style.display = 'none';
                    container.appendChild(next);
                }
            });

            observer.observe(container, { childList: true });

            // ì²« íŠ¸ë¦¬ê±°
            log('â‘¤ CATER ', '  íŠ¸ë¦¬ê±° div ì¶”ê°€ â†’ DOM ë³€í™” â†’ Microtask Queue ë“±ë¡');
            const trigger = document.createElement('div');
            trigger.style.display = 'none';
            container.appendChild(trigger);
        }

        document.getElementById('start-btn').addEventListener('click', () => {
            raceStart.time = performance.now();
            console.clear();
            console.log('%c=== ğŸ Step 5: FINAL â€” ì´ë²¤íŠ¸ ë£¨í”„ ì™„ì„± ===', 'font-size:1rem; font-weight:bold; color:#ff6b35;');
            console.log('%cì‹¤í–‰ ìˆœì„œ: â‘ (ë™ê¸°) â†’ ë“±ë¡: â‘¡â‘¢â‘£â‘¤ â†’ ì²˜ë¦¬: â‘¢â‘£â‘¤(Microtask) â†’ â‘¡(Task Queue)', 'color:#888;');
            console.log('');

            runPikaSection();         // â‘  ë™ê¸° ë¸”ë¡œí‚¹
            runSquirtleSection();     // â‘¡ Task Queue ë“±ë¡
            runBulbaSection();        // â‘¢ Microtask ë“±ë¡
            runJigglypuffSection();   // â‘£ Microtask ë“±ë¡
            runCaterpieSection();     // â‘¤ Microtask ë“±ë¡ + íŠ¸ë¦¬ê±°
            // ì½œìŠ¤íƒ ë¹„ì›Œì§ â†’ â‘¢â‘£â‘¤ Microtask ì „ë¶€ ì†Œì§„ â†’ â‘¡ Task Queue
        });
    </script>
</body>
</html>