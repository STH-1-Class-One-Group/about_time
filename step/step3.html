<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Step 3 â€” Microtask Queue (Promise .then)</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0d0d1a; --surface: #13132b; --border: #2a2a4a;
            --text: #e8e8ff; --muted: #6666aa;
            --pika: #f1c40f; --squirt: #3498db; --bulba: #2ecc71;
        }
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'IBM Plex Mono', monospace; background: var(--bg); color: var(--text); padding: 40px 20px; }

        h1 { font-family: 'Press Start 2P', monospace; font-size: 0.9rem; color: var(--bulba); text-align: center; margin-bottom: 8px; line-height: 1.8; }
        .subtitle { text-align: center; color: var(--muted); font-size: 0.7rem; margin-bottom: 32px; }

        .race-track { display: flex; gap: 16px; max-width: 1060px; margin: 0 auto 24px; flex-wrap: wrap; }
        .panel { flex: 1 1 280px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .panel.taskqueue  { background: rgba(52,152,219,0.06);  border-color: rgba(52,152,219,0.25); }
        .panel.microtask  { background: rgba(46,204,113,0.06);  border-color: rgba(46,204,113,0.25); }
        .panel h2 { font-family: 'Press Start 2P', monospace; font-size: 0.52rem; text-align: center; margin-bottom: 14px; line-height: 1.9; padding-bottom: 10px; border-bottom: 1px solid var(--border); }

        .card { border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; margin-bottom: 8px; background: rgba(255,255,255,0.03); animation: popIn 0.2s ease; }
        .card p { font-size: 0.72rem; margin: 2px 0; }
        @keyframes popIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

        .timer { font-size: 0.65rem; text-align: center; margin-bottom: 10px; font-weight: 600; }

        .btn-row { display: flex; justify-content: center; margin-bottom: 32px; }
        button { font-family: 'Press Start 2P', monospace; font-size: 0.6rem; padding: 14px 28px; background: var(--bulba); color: #000; border: none; border-radius: 4px; cursor: pointer; box-shadow: 0 4px 0 #1a8a4a; }
        button:active { transform: translateY(2px); }

        .console-tip { text-align: center; font-size: 0.65rem; color: var(--muted); margin-bottom: 24px; }
        .console-tip code { color: var(--bulba); }

        .explain { background: rgba(46,204,113,0.06); border: 1px solid rgba(46,204,113,0.2); border-radius: 8px; padding: 16px; max-width: 1060px; margin: 0 auto; font-size: 0.68rem; line-height: 1.9; color: var(--muted); }
        .explain strong { color: var(--text); }
    </style>
</head>
<body>

    <h1>Step 3</h1>
    <h1 style="margin-top:4px; color:var(--bulba);">Microtask Queue</h1>
    <p class="subtitle">Promise.resolve().then() â€” ì´ìƒí•´ì”¨ ê³„ì—´ ì¶”ê°€</p>
    <p class="console-tip">ğŸ’¡ <code>F12 â†’ Console</code> í•µì‹¬: ê¼¬ë¶€ê¸°ë³´ë‹¤ ì´ìƒí•´ì”¨ê°€ ë¨¼ì € ì²˜ë¦¬ë©ë‹ˆë‹¤</p>

    <div class="btn-row">
        <button id="start-btn">ğŸ START</button>
    </div>

    <div class="race-track">
        <div class="panel">
            <h2 style="color:var(--pika);">â‘  Pikachu Family ğŸŸ¡<br>CallStack (ë™ê¸°)</h2>
            <div id="sync-timer" class="timer" style="color:var(--pika);">Ready...</div>
            <div id="sync-container"></div>
        </div>

        <div class="panel taskqueue">
            <h2 style="color:var(--squirt);">â‘¡ Squirtle Family ğŸ”µ<br>Task Queue (setTimeout)</h2>
            <div id="squirtle-timer" class="timer" style="color:var(--squirt);">Ready...</div>
            <div id="squirtle-container"></div>
        </div>

        <div class="panel microtask">
            <h2 style="color:var(--bulba);">â‘¢ Bulbasaur Family ğŸŒ¿<br>Microtask (Promise .then)</h2>
            <div id="bulba-timer" class="timer" style="color:var(--bulba);">Ready...</div>
            <div id="bulba-container"></div>
        </div>
    </div>

    <div class="explain">
        <strong>í•µì‹¬ ê´€ì°° í¬ì¸íŠ¸</strong><br><br>
        â‘¡ ê¼¬ë¶€ê¸°ì™€ â‘¢ ì´ìƒí•´ì”¨ëŠ” ë‘˜ ë‹¤ "ë‚˜ì¤‘ì— ì²˜ë¦¬" ë˜ì§€ë§Œ ìˆœì„œê°€ ë‹¤ë¦…ë‹ˆë‹¤.<br><br>
        ì½œìŠ¤íƒì´ ë¹„ì›Œì§€ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ë¨¼ì € <strong>Microtask Queueë¥¼ ì „ë¶€ ì†Œì§„</strong>í•©ë‹ˆë‹¤.<br>
        ê·¸ í›„ì—ì•¼ Task Queueì—ì„œ í•˜ë‚˜ì”© êº¼ëƒ…ë‹ˆë‹¤.<br><br>
        â†’ <strong>ì´ìƒí•´ì”¨(Microtask)ê°€ ê¼¬ë¶€ê¸°(Task Queue)ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬ë©ë‹ˆë‹¤.</strong><br>
        ì½˜ì†”ì—ì„œ â‘¢ BULBA ì‹¤í–‰ ë¡œê·¸ê°€ â‘¡ SQUIRT ì‹¤í–‰ ë¡œê·¸ë³´ë‹¤ ë¨¼ì € ì°íˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
    </div>

    <script>
        const raceStart = { time: 0 };

        function log(section, message) {
            const elapsed = ((performance.now() - raceStart.time) / 1000).toFixed(3);
            console.log(`[${elapsed}s] %c${section}%c ${message}`,
                'font-weight:bold; color:#aaffaa;', 'font-weight:normal;');
        }

        function renderCard(containerId, name, label, color) {
            const elapsed = ((performance.now() - raceStart.time) / 1000).toFixed(3);
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <p><strong style="color:${color};">${name}</strong></p>
                <p style="color:${color}; font-size:0.6rem;">${label}</p>
                <p style="color:var(--muted); font-size:0.55rem;">+${elapsed}s</p>
            `;
            document.getElementById(containerId).appendChild(card);
        }

        // â‘  í”¼ì¹´ì¸„ â€” ì™„ì „ ë™ê¸°
        function runPikaSection() {
            document.getElementById('sync-container').innerHTML = '';
            document.getElementById('sync-timer').innerText = 'Running...';
            log('â‘  PIKA  ', 'â–¶ ì‹œì‘ â€” CallStack ë¸”ë¡œí‚¹');

            for (const name of ['í”¼ì¸„', 'í”¼ì¹´ì¸„', 'ë¼ì´ì¸„']) {
                log('â‘  PIKA  ', `  ì½œìŠ¤íƒ ì‹¤í–‰ â†’ ${name}`);
                renderCard('sync-container', name, 'CallStack (ë™ê¸°)', 'var(--pika)');
            }

            log('â‘  PIKA  ', 'â–  ì™„ë£Œ');
            document.getElementById('sync-timer').innerText = 'âœ… ì™„ë£Œ';
        }

        // â‘¡ ê¼¬ë¶€ê¸° â€” Task Queue
        function runSquirtleSection() {
            document.getElementById('squirtle-container').innerHTML = '';
            document.getElementById('squirtle-timer').innerText = 'Waiting...';
            log('â‘¡ SQUIRT', 'â–¶ ì‹œì‘ â€” setTimeout 0ms ë“±ë¡');

            ['ê¼¬ë¶€ê¸°', 'ì–´ë‹ˆë¶€ê¸°', 'ê±°ë¶ì™•'].forEach((name, i) => {
                setTimeout(() => {
                    log('â‘¡ SQUIRT', `  âœ… Task Queue ì‹¤í–‰ â†’ ${name}`);
                    renderCard('squirtle-container', name, 'Task Queue (setTimeout)', 'var(--squirt)');
                    if (i === 2) document.getElementById('squirtle-timer').innerText = 'âœ… ì™„ë£Œ';
                }, 0);

                log('â‘¡ SQUIRT', `  ë“±ë¡ (${name}) â†’ Task Queue ëŒ€ê¸°`);
            });

            log('â‘¡ SQUIRT', 'â–  ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜');
        }

        // â‘¢ ì´ìƒí•´ì”¨ â€” Microtask Queue (Promise.resolve().then ì²´ì´ë‹)
        function runBulbaSection() {
            document.getElementById('bulba-container').innerHTML = '';
            document.getElementById('bulba-timer').innerText = 'Waiting...';
            log('â‘¢ BULBA ', 'â–¶ ì‹œì‘ â€” Promise.resolve().then ì²´ì¸ ë“±ë¡');

            // reduceë¡œ ì²´ì´ë‹ â†’ ìˆœì„œ ë³´ì¥
            // Promise.resolve() ëŠ” ì´ë¯¸ resolved ìƒíƒœ
            // â†’ .then ì½œë°±ì´ ì¦‰ì‹œ Microtask Queueì— ë“±ë¡ë¨
            ['ì´ìƒí•´ì”¨', 'ì´ìƒí•´í’€', 'ì´ìƒí•´ê½ƒ'].reduce((chain, name, i) => {
                return chain.then(() => {
                    log('â‘¢ BULBA ', `  âœ… Microtask Queue â†’ .then() ì‹¤í–‰ â†’ ${name}`);
                    renderCard('bulba-container', name, 'Microtask (Promise .then)', 'var(--bulba)');
                    if (i === 2) document.getElementById('bulba-timer').innerText = 'âœ… ì™„ë£Œ';
                });
            }, Promise.resolve());

            log('â‘¢ BULBA ', 'â–  ì²´ì¸ ë“±ë¡ ì™„ë£Œ â†’ ì¦‰ì‹œ ë°˜í™˜ (ì•„ì§ ì‹¤í–‰ ì•ˆ ë¨)');
        }

        document.getElementById('start-btn').addEventListener('click', () => {
            raceStart.time = performance.now();
            console.clear();
            console.log('%c=== Step 3: Microtask Queue ===', 'font-size:1rem; font-weight:bold; color:#2ecc71;');
            console.log('%cì´ìƒí•´ì”¨(.then)ëŠ” ê¼¬ë¶€ê¸°(setTimeout)ë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬ë©ë‹ˆë‹¤.', 'color:#888;');
            console.log('');

            runPikaSection();     // â‘  ë™ê¸° â€” ë¸”ë¡œí‚¹
            runSquirtleSection(); // â‘¡ Task Queue ë“±ë¡
            runBulbaSection();    // â‘¢ Microtask Queue ë“±ë¡
            // ì½œìŠ¤íƒ ë¹„ì›Œì§ â†’ â‘¢ Microtask ì „ë¶€ ì†Œì§„ â†’ â‘¡ Task Queue í•˜ë‚˜ì”©
        });
    </script>
</body>
</html>